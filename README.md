# HIV Testing Services (HTS)

The project backend API is generated by [LoopBack](http://loopback.io) while the frontend was built using [React](https://reactjs.org).

## Setup

To run the application, 
1. Install [Node.js](https://nodejs.org/) version 8.10.0 or any greater stable version
2. Install git
3. Clone the module onto your local machine
    ```
        cd /var/www
        git clone https://github.com/BaobabHealthTrust/htsV2
    ```
4. Install [Elasticsearch](https://www.elastic.co/products/elasticsearch) 
5. Create configuration files in the *configs/* folder. That is, for each *.example* file, copy file and create a *.json* file then fill in the required data based on the fields
6. Install application dependencies by running the command
    ``` 
        npm install --save --verbose && npm install pm2 -g --verbose
    ```
7. Install [Redis](https://redis.io/download)
8. Setup the database by following instructions in the db/ folder
9. To run the application, execute
    ```
        ./start.sh
    ```
10. To automatically start the application on reboot, run the following command and follow the instructions:
    ```
        pm2 startup
    ```

## HTTPS Setup
1. Navigate to the htsV2/certs directory and run the following commands
```bash
openssl genrsa -out privatekey.pem 1024
openssl req -new -key privatekey.pem -out certrequest.csr
openssl x509 -req -in certrequest.csr -signkey privatekey.pem -out certificate.pem
```

- When the application loads in the browser it'll complain about an insecure URL. Proceed regardless.
- Click the not-secure badge and select the certificate
- Download it and save it as a .crt file
- Add the certificate to the list of trusted authorities in your browser's security settings
- Close the tab and navigate to the application again 

##DDE 3.1 Configuration
1. Make sure the parameters for use_dde and use_art in dde.json are set to false, leave the default values as they are for the other attributes as they are.

2. The primary configuratiom for DDE 3.1 is in site.json
    i.  First set configuration section for DDE to appear like the following
            "use_dde": true,
            "dde_username": "dde_user",
            "dde_password": "dd_password",
            "dde_protocol": "http",
            "dde_host": "dde_ip",
            "dde_port": "dde_port"

    ii.     "use_dde": true or "use_dde": false turns on and off dde 3.1
    iii.    "dde_protocol": "http" defines protocol DDE is running usually http / https
    iv.     "dde_host": "dde_ip" defines IPV4 where DDE is running
    v.      "dde_port": "dde_port" defines port 

## License

This library is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation; either version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along with this library; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA.